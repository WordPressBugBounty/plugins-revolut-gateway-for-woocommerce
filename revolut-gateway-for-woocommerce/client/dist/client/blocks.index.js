(()=>{"use strict";var e={20:(e,t,r)=>{var n=r(609),a=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,c=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,r){var n,o={},u=null,l=null;for(n in void 0!==r&&(u=""+r),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(l=t.ref),t)s.call(t,n)&&!i.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===o[n]&&(o[n]=t[n]);return{$$typeof:a,type:e,key:u,ref:l,props:o,_owner:c.current}}t.Fragment=o,t.jsx=u,t.jsxs=u},848:(e,t,r)=>{e.exports=r(20)},609:e=>{e.exports=window.React}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}(()=>{const e=window.wc.blocksCheckout,t=window.wc.wcBlocksRegistry,n=window.wp.element,a=window.wc.wcSettings,o=window.wp.i18n,s=window.wp.data,c=(0,a.getSetting)("revolut_data"),i=(0,a.getSetting)("revolut_data").revolut_pay_data,u=(0,a.getSetting)("revolut_data").revolut_pay_by_bank_data,l=(0,a.getSetting)("revolut_data").revolut_cc_data,d=(0,a.getSetting)("revolut_data").revolut_payment_request_data,p=e=>(0,o.__)(e,"revolut-gateway-for-woocommerce"),m=({endpoint:e,controller:t="revolut_payment_request_"})=>c.fast_checkout_params.ajax_url.toString().replace("%%wc_revolut_gateway_ajax_endpoint%%",`${t}${e}`);function _(e,t,r){const n=e;if(t&&"object"==typeof t)Object.keys(t).forEach((e=>{_(n,t[e],r?`${r}[${e}]`:e)}));else{const e=null==t?"":t;n.append(r,e)}return n}const y=async({data:e,endpoint:t})=>{const r=_(new FormData,e),n=await fetch(t,{method:"POST",body:r});if(!n.ok)throw new Error("Failed to process your request due to network issue");return await n.json()},h=e=>({countryCode:e.country,region:e.state,city:e.city,streetLine1:e.address_1,streetLine2:e.address_2,postcode:e.postcode}),g=e=>({address_1:e.address||e.addressLine.at(0),address_2:e.address_2||e.addressLine.at(1)||"",city:e.city,state:e.state||e.region,postcode:e.postcode||e.postalCode,country:e.country,phone:e.phone}),v=async()=>{const e=await y({endpoint:m({endpoint:D.GET_EXPRESS_CHECKOUT_PARAMS}),data:{security:c.fast_checkout_params.nonce.get_express_checkout_params}});return e?.success?e.revolut_public_id:Promise.reject(new Error("Something went wrong while creating the payment."))},f=async(e=!1)=>{const t=e?c.route.create_revolut_pbb_order:c.route.create_revolut_order,r=e?c.nonce.create_revolut_pbb_order:c.nonce.create_revolut_order,n=await y({endpoint:t,data:{security:r}});if(n?.success)return n;throw new Error("An unexpected error occurred")},w=async e=>(await y({data:{revolut_public_id:e,security:c.fast_checkout_params.nonce.cancel_order},endpoint:m({endpoint:D.CANCEL_ORDER})})).success,b=async e=>{try{if(await w(e))return{type:"error",message:p("Something went wrong, your order has been cancelled.")};throw new Error("Couldn`t cancel the order")}catch(e){return{type:"failure",message:p("Your order has been completed, but we couldn't redirect you to the confirmation page. Please contact us for assistance.")}}};function E({publicId:e,hasError:t="",captured:r=!0}){return new Promise(((n,a)=>{t&&n();let o=0;const s=setInterval((async()=>{o>10&&(clearInterval(s),n());const t=await y({data:{revolut_public_id:e,is_captured:r?1:0,security:c.nonce.check_payment},endpoint:c.route.check_payment});t&&t.payment_completed&&(clearInterval(s),n()),o++}),3e3)}))}function R(e,{totalRetry:t=2,delay:r=1e3}={}){const n=async t=>{try{const r=await y({data:{revolut_public_id:e,security:c.nonce.capture_payment},endpoint:c.route.capture_payment});return!(!r||!r.is_captured)||await a(t)}catch(e){return await a(t)}},a=async e=>{return e>0&&(await(t=r,new Promise((e=>setTimeout(e,t)))),n(e-1));var t};return n(t)}const S=e=>{if(e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.already_paid)return window.location.href=e.processingResponse.paymentDetails.confirmation_redirect_url,!0},k=async({response:e,paymentMethod:t,shouldSavePayment:r,paymentToken:n=0})=>{try{const{processingResponse:a}=e,{wc_order_id:o,revolut_public_id:s,process_payment_result:i,wc_revolut_capture_payment:d,wc_revolut_check_payment:p}=a.paymentDetails;if(c.nonce.check_payment=p,c.nonce.capture_payment=d,await E({publicId:s,captured:!1}),!await R(s))throw new Error("Can not capture payment result");let m=!0;L.REVOLUT_PAY_BY_BANK===t&&(m="yes"!==u.should_process_on_authorise),await E({publicId:s,captured:m});const _=await(async({revolut_public_id:e,shouldSavePayment:t,wc_order_id:r,paymentMethod:n,process_payment_result:a,used_payment_token:o})=>{try{const s={revolut_gateway:n,security:a,revolut_public_id:e,revolut_payment_error:"",wc_order_id:r,reload_checkout:0,revolut_save_payment_method:Number(n===L.REVOLUT_CARD)&&(Number(t)||Number(l.is_save_payment_method_mandatory)),"wc-revolut_cc-payment-token":o},i=await y({data:s,endpoint:c.route.process_order});if("fail"===i?.result)throw new Error(i?.messages||"Something went wrong while trying to charge your card, please try again");if("success"===i?.result)return i;throw new Error("Failed to process your order due to server issue")}catch(e){throw new Error(e.message||"An unexpected error occurred")}})({wc_order_id:o,revolut_public_id:s,shouldSavePayment:r,paymentMethod:t,process_payment_result:i,used_payment_token:n});if(_.redirect)return window.location.href=decodeURI(_.redirect),{success:!0,type:"success"};throw new Error("Could not redirect you to the confirmation page due to an unexpected error. Please contact the merchant")}catch(e){return{type:"error",message:p(e?.message),retry:!0,messageContext:"wc/checkout/payments"}}},x=async({onSubmit:e,address:t,publicId:r})=>{if(!await R(r))throw new Error("Can not capture payment result");await E({publicId:r});const{billingAddress:n,shippingAddress:a}=t;let o=n.recipient.indexOf(" "),c=n.recipient.substring(0,o),i=n.recipient.substring(o+1);(0,s.dispatch)(j).setBillingAddress({first_name:c,last_name:i,email:t.email,...g(n)}),(0,s.dispatch)(j).setShippingAddress({first_name:c,last_name:i,...g(a)}),e()},P={channel:"woocommerce-blocks"};let C=null;const T=()=>C||("undefined"!=typeof RevolutUpsell&&(C=RevolutUpsell({locale:c.locale,publicToken:c.merchant_public_key})),C),A=()=>{const e=T();if(!e)return;const t=document.getElementById(N);t&&i.banner.points_banner_enabled&&e.promotionalBanner.mount(t,{amount:c.order.amount,variant:"banner",currency:c.order.currency,__metadata:P})},{CART_STORE_KEY:j,PAYMENT_STORE_KEY:O}=window.wc.wcBlocksData,L={REVOLUT_CARD:"revolut_cc",REVOLUT_PAY:"revolut_pay",REVOLUT_PAY_BY_BANK:"revolut_pay_by_bank",REVOLUT_PRB:"revolut_payment_request"},M="wc/checkout/payments",N="revolut-pay-informational-banner",D={GET_EXPRESS_CHECKOUT_PARAMS:"get_express_checkout_params",UPDATE_SHIPPING_METHOD:"update_shipping_method",GET_SHIPPING_OPTIONS:"get_shipping_options",LOAD_ORDER_DATA:"load_order_data",CANCEL_ORDER:"cancel_order",PROCESS_ORDER:"process_payment_result",UPDATE_PAYMENT_TOTAL:"update_payment_total"},I=["error.3ds-failed","error.email-is-not-specified","error.invalid-postcode","error.invalid-email","error.incorrect-cvv-code","error.expired-card","error.do-not-honour","error.insufficient-funds"],U=({paymentOptions:e,onSuccess:t,onError:r},a)=>{const o=(0,n.useRef)(null),s=(0,n.useRef)();return(0,n.useEffect)((()=>((async()=>{const{paymentRequest:n,destroy:a}=await RevolutCheckout.payments({publicToken:c.merchant_public_key,locale:c.locale});if(s.current=a,o.current){const a=n.mount(o.current,{...e,buttonStyle:{action:d.styles.payment_request_button_type,height:d.styles.payment_request_button_height,variant:d.styles.payment_request_button_theme,radius:d.styles.payment_request_button_radius},currency:c.order.currency,shippingOptions:c.fast_checkout_params.free_shipping_option,onSuccess(){t()},onError(e){r(e.message)},onCancel(){r("Payment cancelled!")}});a.canMakePayment().then((e=>{e?a.render():a.destroy()}))}})(),()=>s.current())),a),{revolutPrbRef:o,destroyRef:s}},B=()=>{(0,n.useEffect)((()=>{const e=document.querySelector(".wp-element-button.wc-block-components-checkout-place-order-button");return e&&(e.disabled=!0,e.style.display="none"),()=>{e&&(e.disabled=!1,e.style.display="block")}}),[])},Y=({paymentOptions:e,onSuccess:t,onError:r,onCancel:a},o)=>{const s=(0,n.useRef)(null),u=(0,n.useRef)();return(0,n.useEffect)((()=>((async()=>{const{revolutPay:n,destroy:o}=await RevolutCheckout.payments({publicToken:c.merchant_public_key,locale:c.locale});u.current=o,s.current&&n.mount(s.current,{currency:c.order.currency,totalAmount:0,mobileRedirectUrls:{success:i.mobile_redirect_url,failure:i.mobile_redirect_url,cancel:i.mobile_redirect_url},buttonStyle:{cashback:i.banner.cashback_label_enabled,cashbackCurrency:c.order.currency,variant:i.styles.revolut_pay_button_theme,height:i.styles.revolut_pay_button_height,radius:i.styles.revolut_pay_button_radius},...e}),n.on("payment",(e=>{switch(e.type){case"cancel":a();break;case"success":t(e.orderId);break;case"error":r(e.error.message)}}))})(),()=>{u.current()})),o),{revolutPayRef:s,destroyRef:u}},F=window.wc.wcBlocksData;var q=r(848);const V=({settings:e})=>(0,q.jsxs)("div",{className:"revolut-payment-method-label-container",children:[(0,q.jsx)("strong",{children:e.title}),(0,q.jsx)($,{})]}),G=({settings:e})=>{const{institutions:t,popular_institution_ids:r}=e.pay_by_bank_brands;if(!t||!r)return(0,q.jsx)("div",{className:"revolut-payment-method-label-container",children:(0,q.jsx)("strong",{children:e.title})});const n=[...r.map((e=>t.find((t=>Object.values(t.details)[0].institution_id===e)))).filter(Boolean),...t.filter((e=>!r.includes(Object.values(e.details)[0].institution_id)))],a={firstFive:n.slice(0,5),remainingCount:Math.max(0,n.length-5)};return(0,q.jsxs)("div",{className:"revolut-payment-method-label-container",children:[(0,q.jsx)("strong",{children:e.title}),(0,q.jsxs)("div",{className:"revolut-payment-method-label-scheme-icons",children:[a.firstFive&&a.firstFive.map((e=>(0,q.jsx)("img",{src:e.logo.value,alt:e.name},e.name))),(0,q.jsxs)("strong",{children:["+",a.remainingCount]})]})]})},K=()=>((0,n.useEffect)((()=>{(()=>{const e=T();if(!e)return;const t=document.getElementById("revolut-pay-label-informational-icon");t&&i.banner.label_icon_variant&&e.promotionalBanner.mount(t,{amount:c.order.amount,variant:"cashback"===i.banner.label_icon_variant?"link":i.banner.label_icon_variant,currency:c.order.currency,style:{text:"cashback"===i.banner.label_icon_variant?"cashback":null,color:"blue"},__metadata:P})})()}),[]),(0,q.jsxs)("div",{className:"revolut-payment-method-label-container",children:[(0,q.jsxs)("div",{className:"revolut-pay-label-title-wrapper",children:[(0,q.jsx)("strong",{style:{whiteSpace:"nowrap"},children:i.title}),(0,q.jsx)("div",{style:{marginLeft:"5px",display:"flex"},id:"revolut-pay-label-informational-icon"})]}),(0,q.jsx)("img",{src:`${c.wc_plugin_url}/assets/images/revolut.svg`,style:{marginLeft:2},alt:"Revolut Pay"},"Revolut Pay"),(0,q.jsx)($,{})]})),$=()=>{const{available_card_brands:e,wc_plugin_url:t}=c;return(0,q.jsx)("div",{className:"revolut-payment-method-label-scheme-icons",children:e&&e.filter((e=>"maestro"!==e)).map((e=>(0,q.jsx)("img",{src:`${t}/assets/images/${e}.svg`,style:{marginLeft:2},alt:e},e)))})},H=({inputRef:e})=>{const[t,r]=(0,n.useState)([]),a=(0,n.useRef)(!1),o=()=>{const t=e.current.value.trim().split(/\s+/).length>1;return!t&&a.current?(e.current.classList.add("wc-revolut-cardholder-name-error"),r([{message:"Please provide your full name"}])):(e.current.classList.remove("wc-revolut-cardholder-name-error"),r([])),t};return e.current&&(e.current.isComplete=()=>(a.current=!0,o())),(0,q.jsxs)("div",{className:"form-row validate-required",id:"cardholder-name","data-priority":"10",style:{display:"block",width:"100%",marginBottom:15},children:[(0,q.jsx)("input",{ref:e,type:"text",onChange:o,className:"input-text",name:"wc-revolut-cardholder-name",id:"wc-revolut-cardholder-name",placeholder:"Cardholder name",autoComplete:"cardholder",required:!0}),(0,q.jsx)("div",{style:{marginBottom:10,marginTop:10},children:(0,q.jsx)(X,{errorList:t})})]})},X=({errorList:e})=>(0,q.jsx)("div",{children:e.map(((e,t)=>(0,q.jsx)("li",{className:"card-field-error",children:e.message},t)))}),W=({orderToken:e})=>((0,n.useEffect)((()=>{(e=>{const t=T();if(!t)return;const r=document.getElementById("revolut-upsell-banner");r&&l.banner.upsell_banner_enabled&&t.cardGatewayBanner.mount(r,{orderToken:e})})(e)}),[e]),(0,q.jsx)("div",{id:"revolut-upsell-banner"})),z=({token:e,eventRegistration:t,billing:r,settings:a})=>{const[o,s]=(0,n.useState)(""),{onCheckoutSuccess:i}=t;(0,n.useEffect)((()=>{const e=i(u);return()=>{e()}}),[i,o]),(0,n.useEffect)((()=>{(async()=>{r?.cartTotal?.value&&f().then((e=>{s(e.revolut_order_public_id)})).catch((e=>createErrorNotice(p(e.message||"An unexpected error occurred"),{id:"create_order_failed",context:emitResponse.noticeContexts.PAYMENTS})))})()}),[r.cartTotal.value]);const u=async t=>{if(!S(t))return await function(e,t,{totalRetry:r=3,delay:n=300}={}){return new Promise(((a,o)=>{const s=async r=>{try{const n=await y({data:{revolut_public_id:e,payment_token:t,security:c.nonce.pay_with_token},endpoint:c.route.pay_with_token});n&&n.success?a():i(new Error("failed to pay with saved method"),r)}catch(e){i(new Error("failed to pay with saved method"),r)}},i=(e,t)=>{if(!(t>0))throw o(),new Error(e.message);setTimeout((()=>s(t-1)),n)};s(r)}))}(o,e),await E({publicId:o,hasError:"",captured:!1}),await k({response:t,paymentMethod:L.REVOLUT_CARD,shouldSavePayment:!1,paymentToken:e})}},J=({eventRegistration:e,billing:t,shippingData:r,shouldSavePayment:a,emitResponse:o,components:i,checkoutStatus:u,settings:l})=>{const{onPaymentSetup:d,onCheckoutSuccess:m}=e,_=(0,n.useRef)(),y=(0,n.useRef)(),[g,v]=(0,n.useState)(!1),[w,b]=(0,n.useState)([]),[E,R]=(0,n.useState)(!1),[S,x]=(0,n.useState)(""),[P,C]=(0,n.useState)(0),{createErrorNotice:T,removeAllNotices:A}=(0,s.dispatch)("core/notices"),j=(0,s.select)(F.checkoutStore);(0,n.useEffect)((()=>{const e=d(M),t=m(N);return()=>{e(),t()}}),[m,d,w,g,a,t.billingAddress,r.shippingAddress]),(0,n.useEffect)((()=>{(async()=>{t?.cartTotal?.value&&(R(!0),f().then((e=>{x(e.revolut_order_public_id),C(e.revolut_order_amount),R(!1)})).catch((e=>T(p(e.message||"An unexpected error occurred"),{id:"create_order_failed",context:o.noticeContexts.PAYMENTS}))))})()}),[t.cartTotal.value]);const O=(({onMsg:e,publicId:t},r)=>{const a=(0,n.useRef)(e),o=(0,n.useRef)(null),s=(0,n.useRef)(null);return(0,n.useEffect)((()=>{let e=!1;return s.current&&(s.current.destroy(),a.current({type:"instance_destroyed"})),RevolutCheckout(t).then((t=>{!e&&o.current&&(s.current=t.createCardField({locale:c.locale,target:o.current,hidePostcodeField:!0,onSuccess(){a.current({type:"payment_successful"})},onError(e){I.includes(e.type)?a.current({type:"fields_errors_changed",errors:[e]}):a.current({type:"payment_failed",error:e})},onValidation:e=>a.current({type:"fields_errors_changed",errors:e}),onStatusChange:e=>{a.current({type:"fields_status_changed",status:e})},onCancel(){a.current({type:"payment_cancelled"})}}),a.current({type:"instance_mounted",instance:s.current}))})),()=>{e=!0,s.current&&(s.current.destroy(),s.current=null,a.current({type:"instance_destroyed"}))}}),[t,a,...r]),o})({publicId:S,onMsg:e=>{switch(e.type){case"payment_successful":document.dispatchEvent(new Event("payment_successful"));break;case"payment_failed":document.dispatchEvent(new CustomEvent("payment_failed",{detail:e.error.toString()}));break;case"instance_destroyed":_.current=null;break;case"instance_mounted":_.current=e.instance;break;case"fields_errors_changed":b(e.errors);break;case"fields_status_changed":v(e.status)}}},[P]),M=async()=>{A();let e=null;return t?.billingAddress||(e="Please check your billing address, and retry again."),(!g.completed||w.length>0)&&(e="The payment form is not ready for submission.",_.current&&(_.current.validate(),e="The payment form is not ready for submission. please fix the errors below and retry again.")),l.card_holder_name_field_enabled&&(y.current.isComplete()||(e="The payment form is not ready for submission. please fix the errors below and retry again.")),e?{type:o.responseTypes.ERROR,message:p(e),retry:!0,messageContext:o.noticeContexts.PAYMENTS}:{type:o.responseTypes.SUCCESS,meta:{paymentMethodData:{will_create_account:j.getShouldCreateAccount()}}}},N=async e=>{R(!0);const{billingAddress:n}=t,{shippingAddress:s}=r,c={name:l.card_holder_name_field_enabled&&y.current.value.length>0?y.current.value:`${n.first_name} ${n.last_name}`,email:n.email,phone:n.phone,savePaymentMethodFor:a||l.is_save_payment_method_mandatory?"merchant":""};void 0!==n.country&&void 0!==n.postcode&&(c.billingAddress=h(n),c.shippingAddress=h(n)),s&&void 0!==s.country&&void 0!==s.postcode&&""!==s.postcode&&(c.shippingAddress=h(s));const i=await D({paymentData:c});if(i.success){const t=await k({response:e,paymentMethod:L.REVOLUT_CARD,shouldSavePayment:a});return t&&t.success||R(!1),t}if(i.error)return R(!1),{type:o.responseTypes.ERROR,message:p(i.error||"Unexpected error occurred, please try again later"),retry:!0,messageContext:o.noticeContexts.PAYMENTS};R(!1)},D=async({paymentData:e})=>(_.current.submit(e),new Promise(((e,t)=>{document.addEventListener("payment_successful",(()=>{e({success:!0})})),document.addEventListener("payment_failed",(t=>{e({success:!1,error:t.detail})}))})));return(0,n.useEffect)((()=>{O.current&&(w.length>0?O.current.classList.add("woocommerce-revolut-card-element-error"):O.current.classList.remove("woocommerce-revolut-card-element-error"))}),[w]),(0,q.jsx)(q.Fragment,{children:(0,q.jsx)(i.LoadingMask,{showSpinner:!0,isLoading:u.isProcessing||u.isComplete||E,children:S&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("div",{children:[(0,q.jsx)("div",{id:"woocommerce-revolut-card-element",ref:O}),w.length>0&&(0,q.jsx)(X,{errorList:w})]}),l.card_holder_name_field_enabled&&(0,q.jsx)("div",{style:{marginTop:10},children:(0,q.jsx)(H,{inputRef:y})}),l.banner.upsell_banner_enabled&&(0,q.jsx)("div",{children:(0,q.jsx)(W,{orderToken:S})})]})})})},Q={name:L.REVOLUT_CARD,label:(0,q.jsx)(V,{settings:l}),savedTokenComponent:(0,q.jsx)(z,{settings:l}),content:(0,q.jsx)(J,{settings:l}),edit:(0,q.jsx)("p",{children:p("Revolut Gateway is not available in editor mode")}),ariaLabel:p("Revolut Card`s Gateway"),canMakePayment:()=>l.can_make_payment,supports:{features:["products","subscriptions"],showSavedCards:!0,showSaveOption:!l.is_save_payment_method_mandatory}},Z=()=>((0,n.useEffect)((()=>{A()}),[]),(0,q.jsx)("div",{id:N})),ee=i.can_make_payment&&i.banner.points_banner_enabled,te={metadata:{name:"revolut-gateway-for-woocommerce/revolut-banner",category:"woocommerce",parent:[e.innerBlockAreas.CHECKOUT_ORDER_SUMMARY],attributes:{lock:{type:"object",default:{remove:!0,move:!0}}}},force:!0,component:()=>ee?(0,q.jsx)(Z,{}):""},re=({billing:e,components:t,checkoutStatus:r,eventRegistration:a,emitResponse:o,onSubmit:c,order:i})=>{const{onPaymentSetup:u,onCheckoutSuccess:l,onCheckoutFail:d}=a,{VALIDATION_STORE_KEY:p}=window.wc.wcBlocksData,[m,_]=(0,n.useState)(!1),y=((0,n.useRef)(null),(0,n.useRef)(null)),h=(0,n.useRef)(null),g=(0,s.select)(F.checkoutStore),v=e=>({type:o.responseTypes.ERROR,message:e,retry:!0,messageContext:o.noticeContexts.PAYMENTS}),{revolutPrbRef:f}=U({paymentOptions:{amount:i.revolut_order_amount,requestPayerInfo:{billingAddress:!1},validate:()=>new Promise(((e,t)=>{_(!0),(0,s.select)(p).hasValidationErrors()&&(_(!1),t("Checkout form is incomplete")),c(),document.addEventListener("checkout_success",(()=>{e(!0)})),document.addEventListener("checkout_fail",(()=>{_(!1),t("Something went wrong")}))})),createOrder:()=>({publicId:i.revolut_order_public_id})},onSuccess:async()=>{_(!0);const e=await k({response:y.current,paymentMethod:L.REVOLUT_PRB,shouldSavePayment:0});e&&e.success||(_(!1),h.current.resolve(v(e.message?e.message:"Something went wrong")))},onError:e=>{_(!1),h.current&&h.current.resolve(v(e))}},[i]);return(0,n.useEffect)((()=>{const e=l((async e=>{if(!S(e))return new Promise((t=>{_(!1),y.current=e,document.dispatchEvent(new CustomEvent("checkout_success")),h.current={resolve:t}}))})),t=d((e=>{e&&e.paymentDetails&&e.paymentDetails.wc_order_id||document.dispatchEvent(new CustomEvent("checkout_fail"))})),r=u((e=>({type:o.responseTypes.SUCCESS,meta:{paymentMethodData:{will_create_account:g.getShouldCreateAccount()}}})));return()=>{e(),t(),r()}}),[l,d]),B(),(0,q.jsxs)(q.Fragment,{children:[" ",(0,q.jsx)(t.LoadingMask,{showSpinner:!0,isLoading:m||r.isProcessing||r.isComplete,children:(0,q.jsx)("div",{ref:f})})]})},ne=e=>{const[t,r]=(0,n.useState)();if((0,n.useEffect)((()=>{f().then((e=>r(e)))}),[e.billing.cartTotal.value]),t)return(0,q.jsx)(re,{...e,order:t})},ae={name:"revolut_payment_request",label:(0,q.jsx)(V,{settings:d}),content:(0,q.jsx)(ne,{}),edit:(0,q.jsx)("p",{children:p("Google/Apple Pay block is not available in editor mode")}),ariaLabel:"Google Pay/Apple Pay",canMakePayment:()=>d.can_make_payment,paymentMethodId:"revolut_payment_request",supports:{features:["products"]}},oe=({billing:e,setExpressPaymentError:t,eventRegistration:r,onSubmit:a,onClick:o,onClose:s,emitResponse:i})=>{const{onPaymentSetup:u,onCheckoutFail:l}=r,d=(0,n.useRef)(),p=(0,n.useRef)(),{revolutPrbRef:_,destroyRef:h}=U({paymentOptions:{amount:0,requestShipping:!0,validate:()=>(o(),!0),onShippingOptionChange:e=>function(e){let t={security:c.fast_checkout_params.nonce.update_shipping,shipping_method:[e.id],is_product_page:c.fast_checkout_params.is_product_page};return new Promise(((e,r)=>{y({data:t,endpoint:m({endpoint:D.UPDATE_SHIPPING_METHOD})}).then((t=>{e(t)})).catch((e=>{r(e)}))}))}(e),onShippingAddressChange:e=>function(e){let t={security:c.fast_checkout_params.nonce.shipping,country:e.country,state:e.region,postcode:e.postalCode,city:e.city,address:"",address_2:"",is_product_page:c.fast_checkout_params.is_product_page,require_shipping:c.fast_checkout_params.shipping_required};return new Promise(((e,r)=>{y({data:t,endpoint:m({endpoint:D.GET_SHIPPING_OPTIONS})}).then((t=>{e(t)})).catch((e=>{r(e)}))}))}(e),createOrder:()=>new Promise(((e,t)=>{v().then((t=>{p.current=t,e({publicId:t})})).catch((e=>{t(e)}))})),validate(e){d.current=e}},onSuccess:()=>x({onSubmit:a,address:d.current,publicId:p.current}).catch((e=>{h.current(),w(p.current),t(e)})),onError:e=>{t(e||"Something went wrong while completing your payment"),s()},onCancel:e=>{t(e),s()}},[e.cartTotal.value]);return(0,n.useEffect)((()=>{const e=u((()=>({type:i.responseTypes.SUCCESS,meta:{paymentMethodData:{is_express_checkout:1}}}))),r=l((()=>{b(p.current).then((e=>{t(e.message),"failure"===e.type&&h.current()}))}));return()=>{e(),r()}}),[u,l]),(0,q.jsxs)(q.Fragment,{children:[" ",(0,q.jsx)("div",{ref:_})]})},se={name:"revolut_payment_request_express_checkout",paymentMethodId:"revolut_payment_request",content:(0,q.jsx)(oe,{}),edit:(0,q.jsx)("p",{children:p("Google/Apple Pay block is not available in editor mode")}),ariaLabel:"Google Pay/Apple Pay",canMakePayment:()=>d.can_make_payment&&d.is_cart,supports:{features:["products"]}},ce=({billing:e,components:t,eventRegistration:r,onSubmit:a,emitResponse:o,order:c})=>{const{onPaymentSetup:i,onCheckoutSuccess:u,onCheckoutFail:l}=r,{VALIDATION_STORE_KEY:d}=window.wc.wcBlocksData,[p,m]=(0,n.useState)(!1),[_,y]=(0,n.useState)(!1),h=(0,n.useRef)(null),g=(0,n.useRef)(null),v=(0,s.select)(F.checkoutStore),f=e=>({type:o.responseTypes.ERROR,message:e,retry:!0,messageContext:o.noticeContexts.PAYMENTS}),w={totalAmount:c.revolut_order_amount,validate:()=>(y(!1),new Promise((e=>{m(!0),(0,s.select)(d).hasValidationErrors()&&(m(!1),e(!1)),a(),document.addEventListener("checkout_success",(()=>{e(!0)})),document.addEventListener("checkout_fail",(()=>{m(!1),e(!1)}))}))),createOrder:()=>({publicId:c.revolut_order_public_id})},{revolutPayRef:b}=Y({paymentOptions:w,onSuccess:async()=>{m(!0);const e=await k({response:h.current,paymentMethod:L.REVOLUT_PAY,shouldSavePayment:0});e&&e.success||(m(!1),g.current.resolve(f(e.message?e.message:"Something went wrong")))},onError:e=>{m(!1),g.current&&g.current.resolve(f(e))},onCancel:()=>{window.location.reload(),y(!0),g.current&&g.current.resolve(f("Payment cancelled!"))}},[c]);return(0,n.useEffect)((()=>{const e=u((async e=>new Promise((t=>{if(!S(e)){if(_)return m(!1),t(f("Payment cancelled!"));m(!1),h.current=e,document.dispatchEvent(new CustomEvent("checkout_success")),g.current={resolve:t}}})))),t=l((e=>{e&&e.paymentDetails&&e.paymentDetails.wc_order_id||document.dispatchEvent(new CustomEvent("checkout_fail"))})),r=i((e=>({type:o.responseTypes.SUCCESS,meta:{paymentMethodData:{will_create_account:v.getShouldCreateAccount()}}})));return()=>{e(),t(),r()}}),[u,l,_]),B(),(0,q.jsxs)(q.Fragment,{children:[" ",(0,q.jsx)(t.LoadingMask,{showSpinner:!0,isLoading:p,children:(0,q.jsx)("div",{ref:b})})]})},ie=new URLSearchParams(window.location.search),ue=ie.get("_rp_fr"),le=ie.get("_rp_oid"),de=ie.get("_rp_s");(ue||!de&&le)&&((0,s.dispatch)("core/notices").createErrorNotice(p(ue||"Payment Rejected"),{id:"rp-fr",context:M}),(0,s.dispatch)(O).__internalSetActivePaymentMethod(L.REVOLUT_PAY));const pe=e=>{const[t,r]=(0,n.useState)();if((0,n.useEffect)((()=>{f().then((e=>r(e)))}),[e.billing.cartTotal.value]),t)return(0,q.jsx)(ce,{...e,order:t})},me={name:"revolut_pay",label:(0,q.jsx)(K,{}),content:(0,q.jsx)(pe,{}),edit:(0,q.jsx)("p",{children:p("Revolut Pay is not available in editor mode")}),ariaLabel:"Revolut Pay",canMakePayment:()=>i.can_make_payment,paymentMethodId:"revolut_pay",supports:{features:["products"]}},_e=({billing:e,setExpressPaymentError:t,eventRegistration:r,onSubmit:a,onClick:o,onClose:s,emitResponse:i})=>{const{onPaymentSetup:u,onCheckoutFail:l}=r,d=(0,n.useRef)(),p={requestShipping:!0,validate:()=>(o(),!0),createOrder:()=>v().then((e=>(d.current=e,(e=>y({data:{revolut_public_id:e,security:c.fast_checkout_params.nonce.update_order_total},endpoint:m({endpoint:D.UPDATE_PAYMENT_TOTAL})}))(e).then((()=>({publicId:e}))))))},{revolutPayRef:_,destroyRef:h}=Y({paymentOptions:p,onSuccess:e=>(async e=>{try{const t=await y({data:{security:c.fast_checkout_params.nonce.load_order_data,revolut_public_id:e},endpoint:m({endpoint:D.LOAD_ORDER_DATA})});if(t)return t;throw new Error("Something went wrong while retrieving the billing address. your payment will be cancelled")}catch(e){throw new Error(e.message||"An unexpected error occurred.")}})(e).then((r=>{x({onSubmit:a,address:r.address_info,publicId:d.current}).catch((r=>{h.current(),w(e),t(r)}))})).catch((r=>{w(e),t(r)})),onError:e=>{t(e||"Something went wrong while completing your payment"),s()},onCancel:e=>{t(e||"Payment cancelled!"),s()}},[e.cartTotal.value]);return(0,n.useEffect)((()=>{const e=u((()=>({type:i.responseTypes.SUCCESS,meta:{paymentMethodData:{is_express_checkout:1}}}))),r=l((()=>{b(d.current).then((e=>{t(e.message),"failure"===e.type&&h.current()}))}));return()=>{e(),r()}}),[u,l]),(0,n.useEffect)((()=>{A()}),[]),(0,q.jsxs)(q.Fragment,{children:[" ",(0,q.jsx)("div",{id:N}),(0,q.jsx)("div",{ref:_})]})},ye=new URLSearchParams(window.location.search),he=ye.get("_rp_fr"),ge=ye.get("_rp_oid"),ve=ye.get("_rp_s");(he||!ve&&ge)&&(0,s.dispatch)("core/notices").createErrorNotice(p(he||"Payment Rejected"),{id:"rp-fr",context:M});const fe={name:"revolut_pay_express_checkout",edit:(0,q.jsx)("p",{children:p("Revolut Pay is not available in editor mode")}),ariaLabel:"Revolut Pay",paymentMethodId:"revolut_pay",content:(0,q.jsx)(_e,{settings:i}),canMakePayment:()=>i.can_make_payment&&i.is_cart,supports:{features:["products"]}},we=({eventRegistration:e,billing:t,emitResponse:r})=>{const{onPaymentSetup:a,onCheckoutSuccess:o}=e,i=(0,n.useRef)(null),{removeAllNotices:u}=(0,s.dispatch)("core/notices"),l=(0,s.select)(F.checkoutStore),d=async()=>{u();try{return await f(!0),{type:r.responseTypes.SUCCESS,meta:{paymentMethodData:{will_create_account:l.getShouldCreateAccount()}}}}catch(e){return{type:r.responseTypes.ERROR,message:p(e),retry:!0,messageContext:r.noticeContexts.PAYMENTS}}};return(0,n.useEffect)((()=>{const e=a(d),t=o((async e=>new Promise((async(t,n)=>{if(S(e))return;const{payByBank:a}=await RevolutCheckout.payments({publicToken:c.merchant_public_key,locale:c.locale});i.current=a({createOrder:()=>({publicId:e.processingResponse.paymentDetails.revolut_public_id}),onError:e=>{t({type:r.responseTypes.ERROR,message:p(e||"Unexpected error occurred, please try again later"),retry:!0,messageContext:r.noticeContexts.PAYMENTS})},onSuccess:async()=>{const n=await k({response:e,paymentMethod:L.REVOLUT_PAY_BY_BANK,shouldSavePayment:0});n&&n.success||t({type:r.responseTypes.ERROR,message:n.message?n.message:p("Something went wrong"),retry:!0,messageContext:r.noticeContexts.PAYMENTS})},onCancel:()=>{window.location.reload(),t({type:r.responseTypes.ERROR,message:p("Payment cancelled!"),retry:!0,messageContext:r.noticeContexts.PAYMENTS})}}),i.current.show()}))));return()=>{i.current&&i.current.destroy(),t(),e()}}),[o]),(0,q.jsx)(q.Fragment,{})},be={name:L.REVOLUT_PAY_BY_BANK,label:(0,q.jsx)(G,{settings:u}),content:(0,q.jsx)(we,{settings:u}),edit:(0,q.jsx)("p",{children:p("Revolut Pay By Bank Gateway is not available in editor mode")}),ariaLabel:p("Revolut Pay By Bank Gateway"),canMakePayment:()=>u.can_make_payment};(0,t.registerPaymentMethod)(Q),(0,t.registerPaymentMethod)(be),(0,t.registerExpressPaymentMethod)(fe),(0,t.registerPaymentMethod)(me),(0,e.registerCheckoutBlock)(te),(0,t.registerExpressPaymentMethod)(se),(0,t.registerPaymentMethod)(ae)})()})();